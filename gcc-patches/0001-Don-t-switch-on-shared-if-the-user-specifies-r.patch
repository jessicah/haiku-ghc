From 0c2a2ce9350ea9cef2a79397e7b1d383f4916b06 Mon Sep 17 00:00:00 2001
From: Nick Smallbone <nick.smallbone@gmail.com>
Date: Fri, 3 Oct 2014 16:16:03 +0200
Subject: [PATCH] Don't switch on -shared if the user specifies -r

---
 gcc/gcc/config/arm/haiku.h  | 2 +-
 gcc/gcc/config/i386/haiku.h | 2 +-
 gcc/gcc/config/mips/haiku.h | 2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/gcc/gcc/config/arm/haiku.h b/gcc/gcc/config/arm/haiku.h
index 392a462..f0c0d63 100644
--- a/gcc/gcc/config/arm/haiku.h
+++ b/gcc/gcc/config/arm/haiku.h
@@ -75,6 +75,6 @@
 /* If ELF is the default format, we should not use /lib/elf.  */
 
 #undef	LINK_SPEC
-#define LINK_SPEC "%{!o*:-o %b} -m armelf -shared %{nostart:-e 0} %{shared:-e 0} %{!shared: %{!nostart: -no-undefined}}\
+#define LINK_SPEC "%{!o*:-o %b} -m armelf %{!r:-shared} %{nostart:-e 0} %{shared:-e 0} %{!shared: %{!nostart: -no-undefined}}\
   %{mbig-endian:-EB} %{mlittle-endian:-EL} -X"
 
diff --git a/gcc/gcc/config/i386/haiku.h b/gcc/gcc/config/i386/haiku.h
index 6647b42..3379e19 100644
--- a/gcc/gcc/config/i386/haiku.h
+++ b/gcc/gcc/config/i386/haiku.h
@@ -53,7 +53,7 @@ Boston, MA 02111-1307, USA.  */
 /* If ELF is the default format, we should not use /lib/elf.  */
 
 #undef	LINK_SPEC
-#define LINK_SPEC "-m elf_i386_haiku -shared %{nostart:-e 0} %{shared:-e 0} %{!shared: %{!nostart: -no-undefined}}"
+#define LINK_SPEC "-m elf_i386_haiku %{!r:-shared} %{nostart:-e 0} %{shared:-e 0} %{!shared: %{!nostart: -no-undefined}}"
 
 /* A C statement (sans semicolon) to output to the stdio stream
    FILE the assembler definition of uninitialized global DECL named
diff --git a/gcc/gcc/config/mips/haiku.h b/gcc/gcc/config/mips/haiku.h
index c62a8d5..f6d2efb 100644
--- a/gcc/gcc/config/mips/haiku.h
+++ b/gcc/gcc/config/mips/haiku.h
@@ -40,5 +40,5 @@ Boston, MA 02111-1307, USA.  */
   while (0)
 
 #undef	LINK_SPEC
-#define LINK_SPEC "%{!o*:-o %b} -m elf_mipsel_haiku -shared %{nostart:-e 0}"
+#define LINK_SPEC "%{!o*:-o %b} -m elf_mipsel_haiku %{!r:-shared} %{nostart:-e 0}"
 
-- 
2.1.2

